<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Toolkit • rray</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Toolkit">
<meta property="og:description" content="">
<meta property="og:image" content="https://rray.r-lib.org/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rray</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/broadcasting.html">Broadcasting</a>
    </li>
    <li>
      <a href="../articles/the-rray.html">The rray</a>
    </li>
    <li>
      <a href="../articles/toolkit.html">Toolkit</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/r-lib/rray">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Toolkit</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-lib/rray/blob/master/vignettes/toolkit.Rmd"><code>vignettes/toolkit.Rmd</code></a></small>
      <div class="hidden name"><code>toolkit.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(rray)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(magrittr)</a></code></pre></div>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>One of the big goals for rray is to be a general purpose toolkit for working with arrays. A requirement of this is that you shouldn’t have to opt into using rray objects to be able to take advantage of broadcasting or the ability to use any of the <code>rray_*()</code> functions. That requirement has been at the core of rray development, and it means that you can use base R vector/matrix/array objects with any of the rray functions, and still get a base R object back out.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">nrow =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">y &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">nrow =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co"># Base R matrices, added with broadcasting</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="kw"><a href="../reference/rray_arith.html">rray_add</a></span>(x, y)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt;      [,1] [,2] [,3]</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt; [1,]    2    4    6</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt; [2,]    4    6    8</span></a></code></pre></div>
</div>
<div id="axes" class="section level2">
<h2 class="hasAnchor">
<a href="#axes" class="anchor"></a>Axes</h2>
<p>Many of the functions in rray are applied “along an axis”. With base R, you might be used to the <code>MARGIN</code> argument when specifying the dimension to apply a function over. In rray, you’ll use <code>axes</code> (or <code>axis</code>, depending on the function). In short, these two are <em>complements</em> of one another. Ignoring the fact that rray doesn’t drop length 1 dimensions, notice that the values computed in the example below are the same, even though the dimensions to compute over look different.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">8</span>, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="kw"><a href="../reference/rray_sum.html">rray_sum</a></span>(x, <span class="dt">axes =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt; , , 1</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt;      [,1] [,2]</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt; [1,]    3    7</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt; , , 2</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co">#&gt;      [,1] [,2]</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co">#&gt; [1,]   11   15</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(x, <span class="dt">MARGIN =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2</span>, <span class="dv">3</span>), <span class="dt">FUN =</span> sum)</a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="co">#&gt;      [,1] [,2]</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="co">#&gt; [1,]    3   11</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="co">#&gt; [2,]    7   15</span></a></code></pre></div>
<p>I find that <code>axes</code> is a more intuitive way to specify the dimensions. This is because with <code>axes</code>, you list the dimensions that you are allowing to change in some way. In the above example, <code>axes = 1</code> was specified which <em>guarantees</em> that the result will have the same dimensions as <code>x</code> everywhere except in the first dimension, which will have length 1, no matter what. In other words, the dimensions change as: <code>(2, 2, 2) -&gt; (1, 2, 2)</code>.</p>
</div>
<div id="binding" class="section level2">
<h2 class="hasAnchor">
<a href="#binding" class="anchor"></a>Binding</h2>
<p>Reducers aren’t the only functions with this <code>axes</code> guarantee. With <code><a href="../reference/rray_bind.html">rray_bind()</a></code>, you specify the <code>.axis</code> that you want to bind along. This has the same guarantee that only the <code>.axis</code> specified will be changing. The only caveat here is that the inputs are first broadcast to a common dimension (ignoring the <code>.axis</code> dimension) before the binding is carried out. A few examples might be helpful:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># (5, 1)</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co"># (3)</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">y &lt;-<span class="st"> </span><span class="dv">6</span><span class="op">:</span><span class="dv">8</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="kw"><a href="../reference/rray_bind.html">rray_bind</a></span>(x, y, <span class="dt">.axis =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt;      [,1]</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt; [1,]    1</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt; [2,]    2</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt; [3,]    3</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt; [4,]    4</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt; [5,]    5</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#&gt; [6,]    6</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#&gt; [7,]    7</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#&gt; [8,]    8</span></a></code></pre></div>
<p>This works by first finding the common dimensions between <code>x</code> and <code>y</code>, ignoring the <code>.axis</code> dimension. So in this case the common dimension is <code>(., 1)</code> where the <code>.</code> represents whatever dimension is actually there for that object. The final result after binding the inputs together will also have a <code>(., 1)</code> shape, where the <code>.</code> will be the sum of all of the 1st dimension sizes of the inputs (in this case <code>5 + 3 = 8</code>).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># (5, 1) where `. = 5` from x</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">x_broadcast &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rray_broadcast.html">rray_broadcast</a></span>(x, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">5</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">x_broadcast</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt;      [,1]</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt; [1,]    1</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt; [2,]    2</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt; [3,]    3</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt; [4,]    4</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt; [5,]    5</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co"># (3, 1) where `. = 3` from y</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12">y_broadcast &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rray_broadcast.html">rray_broadcast</a></span>(y, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb5-13" data-line-number="13">y_broadcast</a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="co">#&gt;      [,1]</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="co">#&gt; [1,]    6</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="co">#&gt; [2,]    7</span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"><span class="co">#&gt; [3,]    8</span></a>
<a class="sourceLine" id="cb5-18" data-line-number="18"></a>
<a class="sourceLine" id="cb5-19" data-line-number="19"><span class="kw"><a href="../reference/rray_bind.html">rray_bind</a></span>(x_broadcast, y_broadcast, <span class="dt">.axis =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb5-20" data-line-number="20"><span class="co">#&gt;      [,1]</span></a>
<a class="sourceLine" id="cb5-21" data-line-number="21"><span class="co">#&gt; [1,]    1</span></a>
<a class="sourceLine" id="cb5-22" data-line-number="22"><span class="co">#&gt; [2,]    2</span></a>
<a class="sourceLine" id="cb5-23" data-line-number="23"><span class="co">#&gt; [3,]    3</span></a>
<a class="sourceLine" id="cb5-24" data-line-number="24"><span class="co">#&gt; [4,]    4</span></a>
<a class="sourceLine" id="cb5-25" data-line-number="25"><span class="co">#&gt; [5,]    5</span></a>
<a class="sourceLine" id="cb5-26" data-line-number="26"><span class="co">#&gt; [6,]    6</span></a>
<a class="sourceLine" id="cb5-27" data-line-number="27"><span class="co">#&gt; [7,]    7</span></a>
<a class="sourceLine" id="cb5-28" data-line-number="28"><span class="co">#&gt; [8,]    8</span></a></code></pre></div>
<p>The <code>.axis</code> is actually taken account when finding the common dimensions. This means that you can bind along an axis that is higher in dimensionality than any of the inputs. For example, you can bind two matrices along the third dimension.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="../reference/rray_bind.html">rray_bind</a></span>(x, x, <span class="dt">.axis =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">#&gt; , , 1</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt;      [,1]</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt; [1,]    1</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt; [2,]    2</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt; [3,]    3</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt; [4,]    4</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="co">#&gt; [5,]    5</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="co">#&gt; , , 2</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="co">#&gt;      [,1]</span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="co">#&gt; [1,]    1</span></a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="co">#&gt; [2,]    2</span></a>
<a class="sourceLine" id="cb6-16" data-line-number="16"><span class="co">#&gt; [3,]    3</span></a>
<a class="sourceLine" id="cb6-17" data-line-number="17"><span class="co">#&gt; [4,]    4</span></a>
<a class="sourceLine" id="cb6-18" data-line-number="18"><span class="co">#&gt; [5,]    5</span></a></code></pre></div>
<p>This works by finding the common dimension between <code>x</code> and <code>x</code>, which is just <code>(5, 1)</code>, and then checking that against the <code>.axis</code>. If <code>.axis</code> is implicitly along a higher dimension, the common dimension is extended as needed. In this case it is extended to <code>(5, 1, 1)</code> to match the fact that you are binding along the third dimension. The inputs are broadcast to that shape, and then bound together.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">x_broadcast &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rray_broadcast.html">rray_broadcast</a></span>(x, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">x_broadcast</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt; , , 1</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt;      [,1]</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt; [1,]    1</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt; [2,]    2</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt; [3,]    3</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt; [4,]    4</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt; [5,]    5</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="kw"><a href="../reference/rray_bind.html">rray_bind</a></span>(x_broadcast, x_broadcast, <span class="dt">.axis =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt; , , 1</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">#&gt;      [,1]</span></a>
<a class="sourceLine" id="cb7-16" data-line-number="16"><span class="co">#&gt; [1,]    1</span></a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="co">#&gt; [2,]    2</span></a>
<a class="sourceLine" id="cb7-18" data-line-number="18"><span class="co">#&gt; [3,]    3</span></a>
<a class="sourceLine" id="cb7-19" data-line-number="19"><span class="co">#&gt; [4,]    4</span></a>
<a class="sourceLine" id="cb7-20" data-line-number="20"><span class="co">#&gt; [5,]    5</span></a>
<a class="sourceLine" id="cb7-21" data-line-number="21"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-22" data-line-number="22"><span class="co">#&gt; , , 2</span></a>
<a class="sourceLine" id="cb7-23" data-line-number="23"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-24" data-line-number="24"><span class="co">#&gt;      [,1]</span></a>
<a class="sourceLine" id="cb7-25" data-line-number="25"><span class="co">#&gt; [1,]    1</span></a>
<a class="sourceLine" id="cb7-26" data-line-number="26"><span class="co">#&gt; [2,]    2</span></a>
<a class="sourceLine" id="cb7-27" data-line-number="27"><span class="co">#&gt; [3,]    3</span></a>
<a class="sourceLine" id="cb7-28" data-line-number="28"><span class="co">#&gt; [4,]    4</span></a>
<a class="sourceLine" id="cb7-29" data-line-number="29"><span class="co">#&gt; [5,]    5</span></a></code></pre></div>
</div>
<div id="dimension-dropping" class="section level2">
<h2 class="hasAnchor">
<a href="#dimension-dropping" class="anchor"></a>Dimension dropping</h2>
<p>One thing you will immediately notice when working with rray is that it often tries <em>not</em> to drop dimensions. This happens most apparently in subsetting, and in the reducers like <code><a href="../reference/rray_sum.html">rray_sum()</a></code> and is in stark contrast to base R.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">ncol =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">x_rray &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as_rray.html">as_rray</a></span>(x)</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"></a>
<a class="sourceLine" id="cb8-4" data-line-number="4">x[<span class="dv">1</span>,]</a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt; [1] 1 4</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6">x_rray[<span class="dv">1</span>,]</a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#&gt; &lt;rray&lt;int&gt;[,2][1]&gt;</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#&gt;      [,1] [,2]</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">#&gt; [1,]    1    4</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(x, <span class="dv">2</span>, sum)</a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt; [1]  6 15</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="kw"><a href="../reference/rray_sum.html">rray_sum</a></span>(x, <span class="dt">axes =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt;      [,1] [,2]</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt; [1,]    6   15</span></a></code></pre></div>
<p>The rationale for this has to do with how broadcasting works. When dimensions aren’t dropped, operations such as the following are natural:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">x_rray <span class="op">/</span><span class="st"> </span><span class="kw"><a href="../reference/rray_sum.html">rray_sum</a></span>(x_rray, <span class="dt">axes =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co">#&gt; &lt;rray&lt;dbl&gt;[,2][3]&gt;</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="co">#&gt;           [,1]      [,2]</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co">#&gt; [1,] 0.1666667 0.2666667</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co">#&gt; [2,] 0.3333333 0.3333333</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co">#&gt; [3,] 0.5000000 0.4000000</span></a></code></pre></div>
<p>This doesn’t work as you might expect with base R, and can result in a tragic error since partial recycling kicks in and you don’t get an error.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">x <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(x, <span class="dv">2</span>, sum)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co">#&gt;           [,1]      [,2]</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#&gt; [1,] 0.1666667 0.2666667</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt; [2,] 0.1333333 0.8333333</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co">#&gt; [3,] 0.5000000 0.4000000</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co"># Equivalent to </span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8">col_sums &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(x, <span class="dv">2</span>, sum)</a>
<a class="sourceLine" id="cb10-9" data-line-number="9">partially_recycled &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(col_sums, <span class="dt">times =</span> <span class="dv">3</span>), <span class="dt">ncol =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb10-10" data-line-number="10">partially_recycled</a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt;      [,1] [,2]</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt; [1,]    6   15</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt; [2,]   15    6</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#&gt; [3,]    6   15</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"></a>
<a class="sourceLine" id="cb10-16" data-line-number="16">x <span class="op">/</span><span class="st"> </span>partially_recycled</a>
<a class="sourceLine" id="cb10-17" data-line-number="17"><span class="co">#&gt;           [,1]      [,2]</span></a>
<a class="sourceLine" id="cb10-18" data-line-number="18"><span class="co">#&gt; [1,] 0.1666667 0.2666667</span></a>
<a class="sourceLine" id="cb10-19" data-line-number="19"><span class="co">#&gt; [2,] 0.1333333 0.8333333</span></a>
<a class="sourceLine" id="cb10-20" data-line-number="20"><span class="co">#&gt; [3,] 0.5000000 0.4000000</span></a></code></pre></div>
<p>This works nicely in rray because of two reasons, both are necessary:</p>
<ul>
<li>The dimensions aren’t dropped</li>
<li>Broadcasting kicks in</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">x_sum &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rray_sum.html">rray_sum</a></span>(x_rray, <span class="dt">axes =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co"># When `/` is called, the inputs are broadcast to the same shape, like this</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4">dim &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rray_dim.html">rray_dim_common</a></span>(x_rray, x_sum)</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">x_broadcast &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rray_broadcast.html">rray_broadcast</a></span>(x_rray, dim)</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">x_sum_broadcast &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rray_broadcast.html">rray_broadcast</a></span>(x_sum, dim)</a>
<a class="sourceLine" id="cb11-7" data-line-number="7"></a>
<a class="sourceLine" id="cb11-8" data-line-number="8">x_broadcast</a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co">#&gt; &lt;rray&lt;int&gt;[,2][3]&gt;</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co">#&gt;      [,1] [,2]</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="co">#&gt; [1,]    1    4</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="co">#&gt; [2,]    2    5</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co">#&gt; [3,]    3    6</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"></a>
<a class="sourceLine" id="cb11-15" data-line-number="15">x_sum_broadcast</a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="co">#&gt; &lt;rray&lt;dbl&gt;[,2][3]&gt;</span></a>
<a class="sourceLine" id="cb11-17" data-line-number="17"><span class="co">#&gt;      [,1] [,2]</span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="co">#&gt; [1,]    6   15</span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"><span class="co">#&gt; [2,]    6   15</span></a>
<a class="sourceLine" id="cb11-20" data-line-number="20"><span class="co">#&gt; [3,]    6   15</span></a>
<a class="sourceLine" id="cb11-21" data-line-number="21"></a>
<a class="sourceLine" id="cb11-22" data-line-number="22">x_broadcast <span class="op">/</span><span class="st"> </span>x_sum_broadcast</a>
<a class="sourceLine" id="cb11-23" data-line-number="23"><span class="co">#&gt; &lt;rray&lt;dbl&gt;[,2][3]&gt;</span></a>
<a class="sourceLine" id="cb11-24" data-line-number="24"><span class="co">#&gt;           [,1]      [,2]</span></a>
<a class="sourceLine" id="cb11-25" data-line-number="25"><span class="co">#&gt; [1,] 0.1666667 0.2666667</span></a>
<a class="sourceLine" id="cb11-26" data-line-number="26"><span class="co">#&gt; [2,] 0.3333333 0.3333333</span></a>
<a class="sourceLine" id="cb11-27" data-line-number="27"><span class="co">#&gt; [3,] 0.5000000 0.4000000</span></a></code></pre></div>
<p>If you do want to drop dimensions with rray, you can explicitly call <code><a href="../reference/rray_squeeze.html">rray_squeeze()</a></code> afterwards. As a rule of thumb, it is much easier to drop dimensions explicitly than it is to recover them.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">x_rray <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/rray_sum.html">rray_sum</a></span>(<span class="dt">axes =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/rray_squeeze.html">rray_squeeze</a></span>(<span class="dt">axes =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="co">#&gt; &lt;rray&lt;dbl&gt;[2]&gt;</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="co">#&gt; [1]  6 15</span></a></code></pre></div>
<p>If you come from NumPy, you might be used to reducers dropping the axis you reduce over. I think this is a mistake, and there have been a number of discussions on the NumPy forums about this choice. Here is why:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co"># This is the result you'd get in a NumPy sum. The 1st dimension is dropped</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">x_sum_dropped &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rray_squeeze.html">rray_squeeze</a></span>(<span class="kw"><a href="../reference/rray_sum.html">rray_sum</a></span>(x_rray, <span class="dt">axes =</span> <span class="dv">1</span>), <span class="dt">axes =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">x_sum_dropped</a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="co">#&gt; &lt;rray&lt;dbl&gt;[2]&gt;</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="co">#&gt; [1]  6 15</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="co"># Now broadcasting doesn't work!</span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8">x_rray <span class="op">/</span><span class="st"> </span>x_sum_dropped</a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="co">#&gt; Error: Non-broadcastable dimensions: (3, 2) and (2).</span></a>
<a class="sourceLine" id="cb13-10" data-line-number="10"></a>
<a class="sourceLine" id="cb13-11" data-line-number="11"><span class="co"># So you have to add back the dimension</span></a>
<a class="sourceLine" id="cb13-12" data-line-number="12"><span class="co"># (numpy has slightly cleaner ways to do this, but it's still an extra step)</span></a>
<a class="sourceLine" id="cb13-13" data-line-number="13">x_sum_reshaped &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rray_expand.html">rray_expand</a></span>(x_sum_dropped, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb13-14" data-line-number="14">x_rray <span class="op">/</span><span class="st"> </span>x_sum_reshaped</a>
<a class="sourceLine" id="cb13-15" data-line-number="15"><span class="co">#&gt; &lt;rray&lt;dbl&gt;[,2][3]&gt;</span></a>
<a class="sourceLine" id="cb13-16" data-line-number="16"><span class="co">#&gt;           [,1]      [,2]</span></a>
<a class="sourceLine" id="cb13-17" data-line-number="17"><span class="co">#&gt; [1,] 0.1666667 0.2666667</span></a>
<a class="sourceLine" id="cb13-18" data-line-number="18"><span class="co">#&gt; [2,] 0.3333333 0.3333333</span></a>
<a class="sourceLine" id="cb13-19" data-line-number="19"><span class="co">#&gt; [3,] 0.5000000 0.4000000</span></a></code></pre></div>
<p>For the curious, Julia’s implementation of reducers works similarly to rray.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#axes">Axes</a></li>
      <li><a href="#binding">Binding</a></li>
      <li><a href="#dimension-dropping">Dimension dropping</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Davis Vaughan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
